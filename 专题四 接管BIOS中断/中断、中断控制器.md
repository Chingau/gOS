本篇内容参考《操作系统真象还原》书中的第7章——中断

# 中断
把中断按事件来源分类，来自CPU外部的中断就称为**外部中断**，来自CPU内部的中断称为**内部中断**。其实还可以再细分，外部中断按是否导致宕机来划分，可分为**可屏蔽中断**和**不可屏蔽中断**，而内部中断按是否正常来划分，可分为**软中断**和**异常**。

## 外部中断
CPU为我们提供了两条信号线。外部硬件的中断是通过两根信号线通知CPU的，这两根信号线就是INTR(INTeRrupt)和NMI(Non Maskable Interrupt)。示意图如下：

![](images/Snipaste_2023-05-20_12-30-57.png)

> 注意：本篇内容仅基于单核CPU讨论的。

CPU收到中断后，得知道发生了什么事情才能执行相应的处理办法。这是通过中断向量表或中断描述符表(中断向量表是实模式下的中断处理程序数组，在保护模式下已经被中断描述符表代替)来实现的，首先为每一种中断分配一个中断向量号，中断向量号就是一个整数，它就是中断向量表或中断描述符表中的索引下标，用来索引中断项。中断发起时，相应的中断向量号通过NMI或INTR引脚被传入CPU，中断向量号是中断向量表或中断描述符表里中断项的下标，CPU根据此中断向量号在中断向量表或中断描述符表中检索对应的中断处理程序并去执行。

## 内部中断
内部中断可分为软中断和异常。软中断就是由软件主动发起的中断，因为它来自于软件，所以称为软中断。由于该中断是软件运行中主动发起的，所以它是主观上的，并不是客观上的某种内部错误。

![](images/Snipaste_2023-05-20_14-39-29.png)

上表中Error code字段中，如果值是Y，表示相应中断会由CPU压入错误码。上表中的第一列的Vector No.就是中断向量号，其值范围0~255。

中断机制的本质是来了一个中断信号后，调用相应的中断处理程序。所以，CPU不管有多少种类型的中断，为了统一中断管理，把来自外部设备、内部指令的各种中断类型统一归结为一种管理方式，即为每个中断信号分配一个整数，用此整数作为中断的ID，而这个整数就是所谓的中断向量，然后用此ID作为中断描述符表中的索引，这样就能找到对应的表项，进而从中找到对应的中断处理程序。

中断向量的作用和选择子类似，它们都用来描述符表中索引一个描述符，只不过选择子用来在GDT或LDT中检索段描述符，而中断向量专用于中断描述符表，其中没有PRL字段。

异常和不可屏蔽中断的中断向量号是由CPU自动提供的，而来自外部设备的可屏蔽中断号是由中断代理提供的(咱们这里的中断代理就是中断控制芯片8259A)，软中断是由软件提供的。

# 可编程中断控制器8259A






